const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D7WViJgy.js","./C-7uryom.js","./entry.BjR7VLcc.css","./TextViewerMarkdown.QrblP95Q.css","./BRTtysAn.js"])))=>i.map(i=>d[i]);
import{c as q,b as P}from"./DOwFC9TG.js";import{D as O,r as _,F as y,s as H,av as z,n as E,$ as F,aw as G,o as I,c as W,I as X,a5 as D,ax as J,ay as Q,K as B,az as M,ab as Y,aA as Z,aq as N,_ as A,a8 as ee,a2 as K,w as k,x as d,b as $,e as S,d as V,t as L,ao as te,a7 as oe,aa as ne}from"./C-7uryom.js";import{_ as re}from"./DULxEgAi.js";const ae=O({__name:"MonacoEditor.client",props:{lang:{default:()=>"plaintext"},options:{default:()=>({})},modelValue:{default:()=>""}},emits:["update:modelValue","load"],setup(r,{expose:b,emit:s}){const o=r,i=s,u=_(!0),c=y(()=>o.lang||o.options.language),m=H(),p=_(),t=z(),f={automaticLayout:!0};let e,n;return E(()=>o.modelValue,()=>{(e==null?void 0:e.getValue())!==o.modelValue&&(e==null||e.setValue(o.modelValue))}),E(()=>o.lang,()=>{n&&n.dispose(),n=t.editor.createModel(o.modelValue,c.value),e==null||e.setModel(n)}),E(()=>o.options,()=>{e==null||e.updateOptions(F(o.options,f))}),E(p,(g,x)=>{!p.value||x||(e=t.editor.create(p.value,F(o.options,f)),n=t.editor.createModel(o.modelValue,c.value),m.value=e,e.layout(),e.setModel(n),e.onDidChangeModelContent(()=>{i("update:modelValue",e.getValue())}),u.value=!1,i("load",e))}),b({$editor:m}),G(()=>{e==null||e.dispose(),n==null||n.dispose()}),(g,x)=>(I(),W("div",{ref_key:"editorElement",ref:p},[u.value?X(g.$slots,"default",{key:0}):D("",!0)],512))}}),ie=()=>{const r=y(()=>navigator&&navigator.userAgent&&navigator.userAgent.match(/Macintosh;/)),b=_(" "),s=Q(),o=y(()=>{var m,p,t;const i=(m=s.value)==null?void 0:m.tagName,u=(p=s.value)==null?void 0:p.contentEditable;return i==="INPUT"||i==="TEXTAREA"||u==="true"||u==="plaintext-only"?((t=s.value)==null?void 0:t.name)||!0:!1});return B(()=>{b.value=r.value?"âŒ˜":"Ctrl"}),{macOS:r,metaSymbol:b,activeElement:s,usingInput:o}},R=J(ie);function fe(...r){return y(()=>r.every(b=>M(b)))}function le(r){return y(()=>!M(r))}const de=/^[^-]+.*-.*[^-]+$/,ue=/^[^_]+.*_.*[^_]+$/,se=(r,b={})=>{const{macOS:s,usingInput:o}=R();let i=[];const u=_([]),c=()=>{u.value.splice(0,u.value.length)},m=Y(c,b.chainDelay??800),p=t=>{if(!t.key)return;const f=/^[a-z]{1}$/i.test(t.key);let e;if(u.value.push(t.key),u.value.length>=2){e=u.value.slice(-2).join("-");for(const n of i.filter(g=>g.chained))if(n.key===e){n.condition.value&&(t.preventDefault(),n.handler()),c();return}}for(const n of i.filter(g=>!g.chained))if(t.key.toLowerCase()===n.key&&t.metaKey===n.metaKey&&t.ctrlKey===n.ctrlKey&&!(f&&t.shiftKey!==n.shiftKey)){n.condition.value&&(t.preventDefault(),n.handler()),c();return}m()};i=Object.entries(r).map(([t,f])=>{var x,T;if(!f)return null;let e;t.includes("-")&&t!=="-"&&!((x=t.match(de))!=null&&x.length)&&console.trace(`[Shortcut] Invalid key: "${t}"`),t.includes("_")&&t!=="_"&&!((T=t.match(ue))!=null&&T.length)&&console.trace(`[Shortcut] Invalid key: "${t}"`);const n=t.includes("-")&&t!=="-";if(n)e={key:t.toLowerCase(),metaKey:!1,ctrlKey:!1,shiftKey:!1,altKey:!1};else{const v=t.toLowerCase().split("_").map(a=>a);e={key:v.filter(a=>!["meta","ctrl","shift","alt"].includes(a)).join("_"),metaKey:v.includes("meta"),ctrlKey:v.includes("ctrl"),shiftKey:v.includes("shift"),altKey:v.includes("alt")}}if(e.chained=n,!s.value&&e.metaKey&&!e.ctrlKey&&(e.metaKey=!1,e.ctrlKey=!0),typeof f=="function"?e.handler=f:typeof f=="object"&&(e={...e,handler:f.handler}),!e.handler)return console.trace("[Shortcut] Invalid value"),null;const g=[];return f.usingInput?typeof f.usingInput=="string"&&g.push(y(()=>o.value===f.usingInput)):g.push(le(o)),e.condition=fe(...g,...f.whenever||[]),e}).filter(Boolean),Z("keydown",p)},ce=N(()=>A(()=>import("./D7WViJgy.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(r=>r.default||r.default||r)),ge=N(()=>A(()=>import("./BRTtysAn.js"),__vite__mapDeps([4,1,2]),import.meta.url).then(r=>r.default||r.default||r)),me="vs-dark",pe=!0,ke=[{background:"24292e",token:""},{foreground:"959da5",token:"comment"},{foreground:"959da5",token:"punctuation.definition.comment"},{foreground:"959da5",token:"string.comment"},{foreground:"c8e1ff",token:"constant"},{foreground:"c8e1ff",token:"entity.name.constant"},{foreground:"c8e1ff",token:"variable.other.constant"},{foreground:"c8e1ff",token:"variable.language"},{foreground:"b392f0",token:"entity"},{foreground:"b392f0",token:"entity.name"},{foreground:"f6f8fa",token:"variable.parameter.function"},{foreground:"7bcc72",token:"entity.name.tag"},{foreground:"ea4a5a",token:"keyword"},{foreground:"ea4a5a",token:"storage"},{foreground:"ea4a5a",token:"storage.type"},{foreground:"f6f8fa",token:"storage.modifier.package"},{foreground:"f6f8fa",token:"storage.modifier.import"},{foreground:"f6f8fa",token:"storage.type.java"},{foreground:"79b8ff",token:"string"},{foreground:"79b8ff",token:"punctuation.definition.string"},{foreground:"79b8ff",token:"string punctuation.section.embedded source"},{foreground:"c8e1ff",token:"support"},{foreground:"c8e1ff",token:"meta.property-name"},{foreground:"fb8532",token:"variable"},{foreground:"f6f8fa",token:"variable.other"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"d73a49",token:"message.error"},{foreground:"f6f8fa",token:"string source"},{foreground:"c8e1ff",token:"string variable"},{foreground:"79b8ff",token:"source.regexp"},{foreground:"79b8ff",token:"string.regexp"},{foreground:"79b8ff",token:"string.regexp.character-class"},{foreground:"79b8ff",token:"string.regexp constant.character.escape"},{foreground:"79b8ff",token:"string.regexp source.ruby.embedded"},{foreground:"79b8ff",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"7bcc72",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"c8e1ff",token:"support.constant"},{foreground:"c8e1ff",token:"support.variable"},{foreground:"c8e1ff",token:"meta.module-reference"},{foreground:"fb8532",token:"markup.list"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"c8e1ff",token:"markup.quote"},{foreground:"f6f8fa",fontStyle:"italic",token:"markup.italic"},{foreground:"f6f8fa",fontStyle:"bold",token:"markup.bold"},{foreground:"c8e1ff",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"176f2c",background:"f0fff4",token:"markup.inserted"},{foreground:"176f2c",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"176f2c",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"b08800",background:"fffdef",token:"markup.changed"},{foreground:"b08800",background:"fffdef",token:"punctuation.definition.changed"},{foreground:"2f363d",background:"959da5",token:"markup.ignored"},{foreground:"2f363d",background:"959da5",token:"markup.untracked"},{foreground:"b392f0",fontStyle:"bold",token:"meta.diff.range"},{foreground:"c8e1ff",token:"meta.diff.header"},{foreground:"0366d6",fontStyle:"bold",token:"meta.separator"},{foreground:"0366d6",token:"meta.output"},{foreground:"ffeef0",token:"brackethighlighter.tag"},{foreground:"ffeef0",token:"brackethighlighter.curly"},{foreground:"ffeef0",token:"brackethighlighter.round"},{foreground:"ffeef0",token:"brackethighlighter.square"},{foreground:"ffeef0",token:"brackethighlighter.angle"},{foreground:"ffeef0",token:"brackethighlighter.quote"},{foreground:"d73a49",token:"brackethighlighter.unmatched"},{foreground:"d73a49",token:"sublimelinter.mark.error"},{foreground:"fb8532",token:"sublimelinter.mark.warning"},{foreground:"6a737d",token:"sublimelinter.gutter-mark"},{foreground:"79b8ff",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"79b8ff",fontStyle:"underline",token:"string.other.link"}],he={"editor.foreground":"#f6f8fa","editor.background":"#24292e","editor.selectionBackground":"#4c2889","editor.inactiveSelectionBackground":"#444d56","editor.lineHighlightBackground":"#444d56","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#6a737d","editorIndentGuide.background":"#6a737d","editorIndentGuide.activeBackground":"#f6f8fa","editor.selectionHighlightBorder":"#444d56"},be={base:me,inherit:pe,rules:ke,colors:he},ye=q(ae),ve={class:"flex flex-1 w-full h-full"},_e={class:"text-sm pl-2 text-slate-200"},Ve=O({__name:"Text.client",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},flaff:{type:Object,required:!0},mimeType:{type:String,required:!0}},emits:["flaffUpdated","changeFileByName"],setup(r,{emit:b}){const s=z();s&&(s.editor.defineTheme("GitHubDark",be),s.editor.setTheme("GitHubDark"));const o=r,i=_("");_();const u=y(()=>({automaticLayout:!0,readOnly:!o.flaff.isOwner,width:"100%",height:"100%"})),c=ee(),m=_(!0),p=async()=>{m.value=!0;try{const h=await(await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{responseType:"blob"})).text();i.value=h}catch(a){console.error("error",a)}m.value=!1};B(()=>{p()});const t=y(()=>o.mimeType.split("/")[1]||"text/plain"),f=async()=>{try{const a=new File([i.value],o.item.name,{type:o.item.mimeType}),l=new FormData;l.append("file",a);const h=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{method:"PUT",body:l});console.log("res",h),c.add({title:"Success",description:"File saved"})}catch(a){console.error("error",a),c.add({title:"Error",description:"Failed to save file"})}},e=_("editor"),n=["markdown"];B(()=>{n.includes(t.value)&&(e.value="viewer")});const g={markdown:ce},x=y(()=>{const a=ge,l=t.value;return g[l]||a}),T=async()=>{try{await navigator.clipboard.writeText(i.value),c.add({title:"Success",description:"Text copied to clipboard"})}catch(a){console.error("error",a),c.add({title:"Error",description:"Failed to copy text to clipboard"})}},{metaSymbol:v}=R();return se({meta_s:{usingInput:!0,handler:f},meta_shift_c:{usingInput:!0,handler:T}}),(a,l)=>{const h=P,C=ne,U=ye,j=re;return I(),K(j,{isLoading:d(m),item:o.item,"flaff-id":o.flaffId,"is-mime-readable":!0,mimeType:"text/*",flaff:r.flaff,onFlaffUpdated:l[4]||(l[4]=(...w)=>a.$emit("flaffUpdated",...w))},{"header-actions":k(()=>[d(e)=="editor"&&o.flaff.isOwner?(I(),K(C,{key:0,onClick:f,icon:"i-ph-upload",size:"xs",label:"Save"},{default:k(()=>[$("span",null,[S(" Save "),V(h,{size:"xs"},{default:k(()=>[S(L(d(v)),1)]),_:1}),V(h,{size:"xs"},{default:k(()=>[S("S")]),_:1})])]),_:1})):D("",!0),d(e)=="editor"?(I(),K(C,{key:1,onClick:T,icon:"i-ph-copy",size:"xs",label:"Copy to clipboard"},{default:k(()=>[$("span",null,[S(" Copy to clipboard "),V(h,{size:"xs"},{default:k(()=>[S(L(d(v)),1)]),_:1}),V(h,{size:"xs"},{default:k(()=>[S("SHIFT")]),_:1}),V(h,{size:"xs"},{default:k(()=>[S("C")]),_:1})])]),_:1})):D("",!0)]),"footer-bar":k(()=>[$("span",_e," Lang: "+L(d(t)),1)]),"footer-actions":k(()=>[$("div",null,[V(C,{color:d(e)=="viewer"?void 0:"white",label:"Viewer",icon:"i-ph-eye",size:"xs",class:"rounded-r-none",onClick:l[2]||(l[2]=w=>e.value="viewer")},null,8,["color"]),V(C,{color:d(e)=="editor"?void 0:"white",label:"Editor",icon:"i-ph-code",size:"xs",class:"rounded-l-none",onClick:l[3]||(l[3]=w=>e.value="editor")},null,8,["color"])])]),default:k(()=>[$("div",ve,[d(e)=="editor"?(I(),K(U,{key:0,modelValue:d(i),"onUpdate:modelValue":l[0]||(l[0]=w=>te(i)?i.value=w:null),language:d(t),lang:d(t),options:d(u),class:"editor w-[100%]",width:"100%",height:"100%",the:""},null,8,["modelValue","language","lang","options"])):(I(),K(oe(d(x)),{key:1,"flaff-id":o.flaffId,item:o.item,flaff:r.flaff,mimeType:o.mimeType,data:d(i),onChangeFileByName:l[1]||(l[1]=w=>a.$emit("changeFileByName",w))},null,40,["flaff-id","item","flaff","mimeType","data"]))])]),_:1},8,["isLoading","item","flaff-id","flaff"])}}});export{Ve as default};
