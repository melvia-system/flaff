const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CZMa6ekV.js","./BqDm20Qw.js","./entry.CwSmN1pt.css","./mxjl1Hgx.js","./Brz4OqBv.js","./r3CePsig.js","./gn53UTZ3.js","./Video.CYvUkbQJ.css","./Bj9M5xAi.js"])))=>i.map(i=>d[i]);
import{D as k,F as y,r as $,n as F,o as d,a2 as R,w as v,b as s,d as c,x as l,c as E,t as V,ar as B,an as I,as as O,I as g,e as L,Y as D,ao as U,ap as x,_ as w,a7 as A}from"./BqDm20Qw.js";import{_ as C,a as P,c as z}from"./mxjl1Hgx.js";const M={class:"flex justify-between"},S={class:"flex items-center gap-2"},q={class:"flex gap-2"},N={key:0,class:"flex-1 flex justify-center items-center"},K={class:"flex items-center gap-1"},G=s("span",null,"Loading Image Preview",-1),J={class:"flex justify-between"},X={class:"flex items-center gap-2 divide-x divide-gray-500"},Y={class:"flex items-center gap-1 text-sm"},Z={class:"pl-2 flex items-center gap-1 text-sm"},H={class:"flex gap-2"},Q=k({__name:"FileViewerContainer",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},forceViewerMimeType:{type:String},isMimeReadable:{type:Boolean,default:!0},mimeType:{type:String,required:!0},isLoading:{type:Boolean,default:!1},flaff:{type:Object,required:!0}},emits:["flaffUpdated"],setup(e,{emit:j}){const a=e,h=j,m=y(()=>{const t=a.item.size;return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:t<1024*1024*1024?`${(t/1024/1024).toFixed(2)} MB`:`${(t/1024/1024/1024).toFixed(2)} GB`}),T=async()=>{try{const t=await $fetch(`/api/flaff/${a.flaffId}/file/${a.item.uuid}`,{responseType:"blob"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=a.item.name,r.click(),URL.revokeObjectURL(i)}catch(t){console.error("error",t)}},f=$("view");F(f,t=>{if(t==="edit"){const i=document.querySelector(".input-rename");i==null||i.focus()}});const p=$(!1),u=async()=>{if(p.value)return;p.value=!0;const t=a.item.name;try{const i=await $fetch(`/api/flaff/${a.flaff.uuid}/file/${a.item.uuid}/rename`,{method:"PUT",body:JSON.stringify({name:a.item.name})});f.value="view",console.log("res",i)}catch(i){console.error("error",i),a.item.name=t}p.value=!1,console.log("rename",a.item.name),h("flaffUpdated")};return(t,i)=>{const r=D,n=U,o=C,_=P;return d(),R(_,{class:"flex-1 flex flex-col",ui:{body:{base:"flex-1 flex overflow-y-auto",padding:"p-0 sm:p-0"}}},{header:v(()=>[s("div",M,[s("div",S,[c(r,{name:"i-ph-file-duotone"}),l(f)=="view"?(d(),E("span",{key:0,onDblclick:i[0]||(i[0]=b=>f.value="edit")},V(e.item.name),33)):B((d(),E("input",{key:1,autofocus:"","onUpdate:modelValue":i[1]||(i[1]=b=>e.item.name=b),onBlur:u,onKeyup:I(u,["enter"]),class:"input-rename bg-transparent border-b border-gray-500"},null,544)),[[O,e.item.name]])]),s("div",q,[g(t.$slots,"header-actions"),c(o,{items:[[{label:"Rename",icon:"i-ph-pencil",click:()=>{f.value="edit"}}]],mode:"hover",popper:{placement:"bottom-end"}},{default:v(()=>[c(n,{size:"xs",icon:"i-ph-dots-three-outline-vertical-thin"})]),_:1},8,["items"])])])]),footer:v(()=>[s("div",J,[s("div",X,[s("div",Y,[c(r,{name:"i-ph-file-duotone"}),L(" "+V(l(m)),1)]),s("div",Z,[c(r,{name:"i-ph-file-duotone"}),L(" "+V(e.item.mimeType),1)]),g(t.$slots,"footer-bar")]),s("div",H,[g(t.$slots,"footer-actions"),c(n,{color:"white",label:"Download",icon:"i-ph-download",size:"xs",onClick:T})])])]),default:v(()=>[e.isLoading?(d(),E("div",N,[s("div",K,[G,c(r,{name:"i-ph-circle-notch-duotone",class:"animate-spin"})])])):g(t.$slots,"default",{key:1})]),_:3})}}}),W=x(()=>w(()=>import("./CZMa6ekV.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),ee=x(()=>w(()=>import("./Brz4OqBv.js"),__vite__mapDeps([4,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),te=x(()=>w(()=>import("./r3CePsig.js"),__vite__mapDeps([5,1,2,3]),import.meta.url).then(e=>z(e.default||e.default||e))),ie=x(()=>w(()=>import("./gn53UTZ3.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url).then(e=>e.default||e.default||e)),ne=x(()=>w(()=>import("./Bj9M5xAi.js"),__vite__mapDeps([8,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),oe={class:"flex-1 flex justify-center items-center"},ae={class:"flex flex-col justify-center items-center gap-1"},se=s("span",null,"Preview Not Available",-1),re=k({__name:"FileViewer.client",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},flaff:{type:Object,required:!0}},emits:["flaffUpdated"],setup(e,{emit:j}){const a=e,h={ps:"text/pinescript",pinescript:"text/pinescript",sav:"text/sav",ts:"text/typescript",tsx:"text/typescript",js:"text/javascript",jsx:"text/javascript",json:"text/json",yml:"text/yaml",yaml:"text/yaml",md:"text/markdown",markdown:"text/markdown",csv:"text/csv"},m=y(()=>{const n=a.item.extension,o=a.item.mimeType;return h[n]?h[n]:o}),T=["application/pdf","text/*","image/*","video/mp4"],f=y(()=>{const n=m.value;return T.some(o=>new RegExp(o.replace("*",".*")).test(n))}),p={"image/*":W,"application/pdf":ee,"text/*":te,"video/mp4":ie},u=n=>{const o=Object.entries(p).find(([_])=>new RegExp(_.replace("*",".*")).test(m.value));return o==null?void 0:o[1]},t=y(()=>{const n=ne;return u(m.value)||n}),i=$(),r=y(()=>{if(i.value){const n=u(i.value);if(n)return n}return t.value});return(n,o)=>{const _=U,b=Q;return l(f)||l(i)?(d(),R(A(l(r)),{key:0,"flaff-id":e.flaffId,item:e.item,mimeType:l(m),flaff:e.flaff,onFlaffUpdated:o[0]||(o[0]=()=>{n.$emit("flaffUpdated")})},null,40,["flaff-id","item","mimeType","flaff"])):(d(),R(b,{key:1,flaff:e.flaff,"flaff-id":a.flaffId,"force-viewer-mime-type":l(i),"is-mime-readable":l(f),item:a.item,mimeType:l(m),onFlaffUpdated:o[2]||(o[2]=()=>{console.log("flaff-updated"),n.$emit("flaffUpdated")})},{default:v(()=>[s("div",oe,[s("div",ae,[se,c(_,{label:"Read as Text",size:"xs",onClick:o[1]||(o[1]=le=>i.value="text/plain")})])])]),_:1},8,["flaff","flaff-id","force-viewer-mime-type","is-mime-readable","item","mimeType"]))}}}),me=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{me as F,Q as _};
