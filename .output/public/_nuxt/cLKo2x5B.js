const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B36jw8bo.js","./CcZZV5jW.js","./entry.DwxLmr8S.css","./z6m01s7W.js","./0xjiscxx.js","./BlrYfaqR.js","./CcLyxjJk.js","./Video.CYvUkbQJ.css","./IsbETsHr.js"])))=>i.map(i=>d[i]);
import{D,ak as z,F as y,r as L,n as S,am as A,o as c,a2 as E,w as x,b as n,W as B,d as u,x as s,c as T,t as k,as as M,ao as P,at as N,I as v,a5 as F,e as U,Y as q,ap as O,aq as w,_ as h,a7 as K}from"./CcZZV5jW.js";import{_ as W,a as G,c as J}from"./z6m01s7W.js";const X={class:"flex items-center gap-2"},Y={class:"flex gap-2"},Z={key:0,class:"flex gap-2"},H={key:0,class:"flex-1 flex justify-center items-center"},Q={class:"flex items-center gap-1"},ee=n("span",null,"Loading Preview",-1),te={class:"flex items-center gap-2 divide-x divide-gray-500"},ie={class:"flex items-center gap-1 text-sm"},ae={class:"pl-2 flex items-center gap-1 text-sm"},oe={class:"flex gap-2"},ne=D({__name:"FileViewerContainer",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},forceViewerMimeType:{type:String},isMimeReadable:{type:Boolean,default:!0},mimeType:{type:String,required:!0},isLoading:{type:Boolean,default:!1},flaff:{type:Object,required:!0}},emits:["flaffUpdated"],setup(t,{emit:R}){const o=t,_=R,f=z(),$=y(()=>{const e=o.item.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/1024/1024).toFixed(2)} MB`:`${(e/1024/1024/1024).toFixed(2)} GB`}),g=async()=>{try{const e=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{responseType:"blob"}),a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=o.item.name,l.click(),URL.revokeObjectURL(a)}catch(e){console.error("error",e)}},d=L("view");S(d,e=>{if(e==="edit"){const a=document.querySelector(".input-rename");a==null||a.focus()}});const p=L(!1),b=async()=>{if(p.value)return;p.value=!0;const e=o.item.name;try{const a=await $fetch(`/api/flaff/${o.flaff.uuid}/file/${o.item.uuid}/rename`,{method:"PUT",body:JSON.stringify({name:o.item.name})});d.value="view",console.log("res",a)}catch(a){console.error("error",a),o.item.name=e}p.value=!1,console.log("rename",o.item.name),_("flaffUpdated")},m=async()=>{try{const e=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{method:"DELETE"});console.log("res",e),_("flaffUpdated",!0),f.add({title:"Success",description:"File deleted"})}catch(e){console.error("error",e),f.add({title:"Error",description:"Failed to delete file"})}},{width:V}=A(),i=y(()=>V.value<768);return(e,a)=>{const l=q,r=O,C=W,I=G;return c(),E(I,{class:"flex-1 flex flex-col",ui:{body:{base:"flex-1 flex overflow-y-auto",padding:"p-0 sm:p-0"}}},{header:x(()=>[n("div",null,[n("div",{class:B(["flex justify-between",{}])},[n("div",X,[u(l,{name:"i-ph-file-duotone"}),s(d)=="view"?(c(),T("span",{key:0,onDblclick:a[0]||(a[0]=j=>d.value="edit")},k(t.item.name),33)):M((c(),T("input",{key:1,autofocus:"","onUpdate:modelValue":a[1]||(a[1]=j=>t.item.name=j),onBlur:b,onKeyup:P(b,["enter"]),class:"input-rename bg-transparent border-b border-gray-500"},null,544)),[[N,t.item.name]])]),n("div",Y,[s(i)?F("",!0):v(e.$slots,"header-actions",{key:0}),o.flaff.isOwner?(c(),E(C,{key:1,items:[[{label:"Rename",icon:"i-ph-pencil",click:()=>{d.value="edit"}},{label:"Delete",icon:"i-ph-trash",click:()=>{m()}}]],popper:{placement:"bottom-end"}},{default:x(()=>[u(r,{size:"xs",icon:"i-ph-dots-three-outline-vertical-thin"})]),_:1},8,["items"])):F("",!0)])]),s(i)?(c(),T("div",Z,[v(e.$slots,"header-actions")])):F("",!0)])]),footer:x(()=>[n("div",{class:B(["flex justify-between",{"flex-col items-center gap-2":s(i),"flex-row":!s(i)}])},[n("div",te,[n("div",ie,[u(l,{name:"i-ph-file-duotone"}),U(" "+k(s($)),1)]),n("div",ae,[u(l,{name:"i-ph-file-duotone"}),U(" "+k(t.mimeType),1)]),v(e.$slots,"footer-bar")]),n("div",oe,[v(e.$slots,"footer-actions"),u(r,{color:"white",label:"Download",icon:"i-ph-download",size:"xs",onClick:g})])],2)]),default:x(()=>[t.isLoading?(c(),T("div",H,[n("div",Q,[ee,u(l,{name:"i-ph-circle-notch-duotone",class:"animate-spin"})])])):v(e.$slots,"default",{key:1})]),_:3})}}}),se=w(()=>h(()=>import("./B36jw8bo.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),le=w(()=>h(()=>import("./0xjiscxx.js"),__vite__mapDeps([4,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),re=w(()=>h(()=>import("./BlrYfaqR.js"),__vite__mapDeps([5,3,1,2]),import.meta.url).then(t=>J(t.default||t.default||t))),fe=w(()=>h(()=>import("./CcLyxjJk.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url).then(t=>t.default||t.default||t)),ce=w(()=>h(()=>import("./IsbETsHr.js"),__vite__mapDeps([8,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),de={class:"flex-1 flex justify-center items-center"},me={class:"flex flex-col justify-center items-center gap-1"},ue=n("span",null,"Preview Not Available",-1),pe=D({__name:"FileViewer.client",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},flaff:{type:Object,required:!0}},emits:["flaffUpdated","changeFileByName"],setup(t,{emit:R}){const o=t,_={ps:"text/pinescript",pinescript:"text/pinescript",sav:"text/sav",ts:"text/typescript",tsx:"text/typescript",js:"text/javascript",jsx:"text/javascript",json:"text/json",yml:"text/yaml",yaml:"text/yaml",md:"text/markdown",markdown:"text/markdown",csv:"text/csv"},f=y(()=>{const i=o.item.extension,e=o.item.mimeType;return _[i]?_[i]:e}),$=["application/pdf","text/*","image/*","video/mp4"],g=y(()=>{const i=f.value;return $.some(e=>new RegExp(e.replace("*",".*")).test(i))}),d={"image/*":se,"application/pdf":le,"text/*":re,"video/mp4":fe},p=i=>{const e=Object.entries(d).find(([a])=>new RegExp(a.replace("*",".*")).test(f.value));return e==null?void 0:e[1]},b=y(()=>{const i=ce;return p(f.value)||i}),m=L(),V=y(()=>{if(m.value){const i=p(m.value);if(i)return i}return b.value});return(i,e)=>{const a=O,l=ne;return s(g)||s(m)?(c(),E(K(s(V)),{key:0,"flaff-id":t.flaffId,item:t.item,mimeType:s(f),flaff:t.flaff,onFlaffUpdated:e[0]||(e[0]=(...r)=>{i.$emit("flaffUpdated",...r)}),onChangeFileByName:e[1]||(e[1]=r=>i.$emit("changeFileByName",r))},null,40,["flaff-id","item","mimeType","flaff"])):(c(),E(l,{key:1,flaff:t.flaff,"flaff-id":o.flaffId,"force-viewer-mime-type":s(m),"is-mime-readable":s(g),item:o.item,mimeType:s(f),onFlaffUpdated:e[3]||(e[3]=(...r)=>{console.log("flaff-updated"),i.$emit("flaffUpdated",...r)})},{default:x(()=>[n("div",de,[n("div",me,[ue,u(a,{label:"Read as Text",size:"xs",onClick:e[2]||(e[2]=r=>m.value="text/plain")})])])]),_:1},8,["flaff","flaff-id","force-viewer-mime-type","is-mime-readable","item","mimeType"]))}}}),ve=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{ve as F,ne as _};
