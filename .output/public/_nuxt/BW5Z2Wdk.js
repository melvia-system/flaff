const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./hMr9aJhh.js","./ChlnTNEj.js","./entry.DwxLmr8S.css","./CiX2deEI.js","./BQRHNHE5.js","./DxCvaOy8.js","./CMvvjtwz.js","./Video.CYvUkbQJ.css","./DonOuHgT.js"])))=>i.map(i=>d[i]);
import{D as B,ak as D,F as y,r as k,n as I,o as m,a2 as T,w as v,b as n,d,x as s,c as V,t as F,ar as O,an as C,as as A,I as b,a5 as P,e as j,Y as S,ao as U,ap as x,_ as w,a7 as z}from"./ChlnTNEj.js";import{_ as M,a as N,c as q}from"./CiX2deEI.js";const K={class:"flex justify-between"},G={class:"flex items-center gap-2"},J={class:"flex gap-2"},X={key:0,class:"flex-1 flex justify-center items-center"},Y={class:"flex items-center gap-1"},Z=n("span",null,"Loading Image Preview",-1),H={class:"flex justify-between"},Q={class:"flex items-center gap-2 divide-x divide-gray-500"},W={class:"flex items-center gap-1 text-sm"},ee={class:"pl-2 flex items-center gap-1 text-sm"},te={class:"flex gap-2"},ie=B({__name:"FileViewerContainer",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},forceViewerMimeType:{type:String},isMimeReadable:{type:Boolean,default:!0},mimeType:{type:String,required:!0},isLoading:{type:Boolean,default:!1},flaff:{type:Object,required:!0}},emits:["flaffUpdated"],setup(e,{emit:L}){const o=e,_=L,r=D(),E=y(()=>{const i=o.item.size;return i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(2)} KB`:i<1024*1024*1024?`${(i/1024/1024).toFixed(2)} MB`:`${(i/1024/1024/1024).toFixed(2)} GB`}),h=async()=>{try{const i=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{responseType:"blob"}),t=URL.createObjectURL(i),a=document.createElement("a");a.href=t,a.download=o.item.name,a.click(),URL.revokeObjectURL(t)}catch(i){console.error("error",i)}},f=k("view");I(f,i=>{if(i==="edit"){const t=document.querySelector(".input-rename");t==null||t.focus()}});const p=k(!1),g=async()=>{if(p.value)return;p.value=!0;const i=o.item.name;try{const t=await $fetch(`/api/flaff/${o.flaff.uuid}/file/${o.item.uuid}/rename`,{method:"PUT",body:JSON.stringify({name:o.item.name})});f.value="view",console.log("res",t)}catch(t){console.error("error",t),o.item.name=i}p.value=!1,console.log("rename",o.item.name),_("flaffUpdated")},c=async()=>{try{const i=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{method:"DELETE"});console.log("res",i),_("flaffUpdated",!0),r.add({title:"Success",description:"File deleted"})}catch(i){console.error("error",i),r.add({title:"Error",description:"Failed to delete file"})}};return(i,t)=>{const a=S,u=U,$=M,l=N;return m(),T(l,{class:"flex-1 flex flex-col",ui:{body:{base:"flex-1 flex overflow-y-auto",padding:"p-0 sm:p-0"}}},{header:v(()=>[n("div",K,[n("div",G,[d(a,{name:"i-ph-file-duotone"}),s(f)=="view"?(m(),V("span",{key:0,onDblclick:t[0]||(t[0]=R=>f.value="edit")},F(e.item.name),33)):O((m(),V("input",{key:1,autofocus:"","onUpdate:modelValue":t[1]||(t[1]=R=>e.item.name=R),onBlur:g,onKeyup:C(g,["enter"]),class:"input-rename bg-transparent border-b border-gray-500"},null,544)),[[A,e.item.name]])]),n("div",J,[b(i.$slots,"header-actions"),o.flaff.isOwner?(m(),T($,{key:0,items:[[{label:"Rename",icon:"i-ph-pencil",click:()=>{f.value="edit"}},{label:"Delete",icon:"i-ph-trash",click:()=>{c()}}]],mode:"hover",popper:{placement:"bottom-end"}},{default:v(()=>[d(u,{size:"xs",icon:"i-ph-dots-three-outline-vertical-thin"})]),_:1},8,["items"])):P("",!0)])])]),footer:v(()=>[n("div",H,[n("div",Q,[n("div",W,[d(a,{name:"i-ph-file-duotone"}),j(" "+F(s(E)),1)]),n("div",ee,[d(a,{name:"i-ph-file-duotone"}),j(" "+F(e.mimeType),1)]),b(i.$slots,"footer-bar")]),n("div",te,[b(i.$slots,"footer-actions"),d(u,{color:"white",label:"Download",icon:"i-ph-download",size:"xs",onClick:h})])])]),default:v(()=>[e.isLoading?(m(),V("div",X,[n("div",Y,[Z,d(a,{name:"i-ph-circle-notch-duotone",class:"animate-spin"})])])):b(i.$slots,"default",{key:1})]),_:3})}}}),ae=x(()=>w(()=>import("./hMr9aJhh.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),oe=x(()=>w(()=>import("./BQRHNHE5.js"),__vite__mapDeps([4,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),ne=x(()=>w(()=>import("./DxCvaOy8.js"),__vite__mapDeps([5,1,2,3]),import.meta.url).then(e=>q(e.default||e.default||e))),se=x(()=>w(()=>import("./CMvvjtwz.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url).then(e=>e.default||e.default||e)),re=x(()=>w(()=>import("./DonOuHgT.js"),__vite__mapDeps([8,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),le={class:"flex-1 flex justify-center items-center"},fe={class:"flex flex-col justify-center items-center gap-1"},ce=n("span",null,"Preview Not Available",-1),de=B({__name:"FileViewer.client",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},flaff:{type:Object,required:!0}},emits:["flaffUpdated","changeFileByName"],setup(e,{emit:L}){const o=e,_={ps:"text/pinescript",pinescript:"text/pinescript",sav:"text/sav",ts:"text/typescript",tsx:"text/typescript",js:"text/javascript",jsx:"text/javascript",json:"text/json",yml:"text/yaml",yaml:"text/yaml",md:"text/markdown",markdown:"text/markdown",csv:"text/csv"},r=y(()=>{const t=o.item.extension,a=o.item.mimeType;return _[t]?_[t]:a}),E=["application/pdf","text/*","image/*","video/mp4"],h=y(()=>{const t=r.value;return E.some(a=>new RegExp(a.replace("*",".*")).test(t))}),f={"image/*":ae,"application/pdf":oe,"text/*":ne,"video/mp4":se},p=t=>{const a=Object.entries(f).find(([u])=>new RegExp(u.replace("*",".*")).test(r.value));return a==null?void 0:a[1]},g=y(()=>{const t=re;return p(r.value)||t}),c=k(),i=y(()=>{if(c.value){const t=p(c.value);if(t)return t}return g.value});return(t,a)=>{const u=U,$=ie;return s(h)||s(c)?(m(),T(z(s(i)),{key:0,"flaff-id":e.flaffId,item:e.item,mimeType:s(r),flaff:e.flaff,onFlaffUpdated:a[0]||(a[0]=(...l)=>{t.$emit("flaffUpdated",...l)}),onChangeFileByName:a[1]||(a[1]=l=>t.$emit("changeFileByName",l))},null,40,["flaff-id","item","mimeType","flaff"])):(m(),T($,{key:1,flaff:e.flaff,"flaff-id":o.flaffId,"force-viewer-mime-type":s(c),"is-mime-readable":s(h),item:o.item,mimeType:s(r),onFlaffUpdated:a[3]||(a[3]=(...l)=>{console.log("flaff-updated"),t.$emit("flaffUpdated",...l)})},{default:v(()=>[n("div",le,[n("div",fe,[ce,d(u,{label:"Read as Text",size:"xs",onClick:a[2]||(a[2]=l=>c.value="text/plain")})])])]),_:1},8,["flaff","flaff-id","force-viewer-mime-type","is-mime-readable","item","mimeType"]))}}}),ue=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{ue as F,ie as _};
