const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Db0EqV78.js","./BQu9ua1M.js","./entry.DwxLmr8S.css","./CGH9rJHj.js","./Cco9wy8A.js","./BIflh52r.js","./BFO3KDlm.js","./Video.CYvUkbQJ.css","./Dv1NGRQv.js"])))=>i.map(i=>d[i]);
import{D as B,ak as D,F as y,r as F,n as I,o as u,a2 as L,w as v,b as n,d as f,x as s,c as $,t as V,ar as O,an as C,as as A,I as b,e as k,Y as P,ao as U,ap as x,_ as w,a7 as S}from"./BQu9ua1M.js";import{_ as z,a as M,c as N}from"./CGH9rJHj.js";const q={class:"flex justify-between"},K={class:"flex items-center gap-2"},G={class:"flex gap-2"},J={key:0,class:"flex-1 flex justify-center items-center"},X={class:"flex items-center gap-1"},Y=n("span",null,"Loading Image Preview",-1),Z={class:"flex justify-between"},H={class:"flex items-center gap-2 divide-x divide-gray-500"},Q={class:"flex items-center gap-1 text-sm"},W={class:"pl-2 flex items-center gap-1 text-sm"},ee={class:"flex gap-2"},te=B({__name:"FileViewerContainer",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},forceViewerMimeType:{type:String},isMimeReadable:{type:Boolean,default:!0},mimeType:{type:String,required:!0},isLoading:{type:Boolean,default:!1},flaff:{type:Object,required:!0}},emits:["flaffUpdated"],setup(e,{emit:R}){const a=e,_=R,l=D(),T=y(()=>{const i=a.item.size;return i<1024?`${i} B`:i<1024*1024?`${(i/1024).toFixed(2)} KB`:i<1024*1024*1024?`${(i/1024/1024).toFixed(2)} MB`:`${(i/1024/1024/1024).toFixed(2)} GB`}),h=async()=>{try{const i=await $fetch(`/api/flaff/${a.flaffId}/file/${a.item.uuid}`,{responseType:"blob"}),t=URL.createObjectURL(i),o=document.createElement("a");o.href=t,o.download=a.item.name,o.click(),URL.revokeObjectURL(t)}catch(i){console.error("error",i)}},c=F("view");I(c,i=>{if(i==="edit"){const t=document.querySelector(".input-rename");t==null||t.focus()}});const m=F(!1),g=async()=>{if(m.value)return;m.value=!0;const i=a.item.name;try{const t=await $fetch(`/api/flaff/${a.flaff.uuid}/file/${a.item.uuid}/rename`,{method:"PUT",body:JSON.stringify({name:a.item.name})});c.value="view",console.log("res",t)}catch(t){console.error("error",t),a.item.name=i}m.value=!1,console.log("rename",a.item.name),_("flaffUpdated")},d=async()=>{try{const i=await $fetch(`/api/flaff/${a.flaffId}/file/${a.item.uuid}`,{method:"DELETE"});console.log("res",i),_("flaffUpdated",!0),l.add({title:"Success",description:"File deleted"})}catch(i){console.error("error",i),l.add({title:"Error",description:"Failed to delete file"})}};return(i,t)=>{const o=P,p=U,E=z,r=M;return u(),L(r,{class:"flex-1 flex flex-col",ui:{body:{base:"flex-1 flex overflow-y-auto",padding:"p-0 sm:p-0"}}},{header:v(()=>[n("div",q,[n("div",K,[f(o,{name:"i-ph-file-duotone"}),s(c)=="view"?(u(),$("span",{key:0,onDblclick:t[0]||(t[0]=j=>c.value="edit")},V(e.item.name),33)):O((u(),$("input",{key:1,autofocus:"","onUpdate:modelValue":t[1]||(t[1]=j=>e.item.name=j),onBlur:g,onKeyup:C(g,["enter"]),class:"input-rename bg-transparent border-b border-gray-500"},null,544)),[[A,e.item.name]])]),n("div",G,[b(i.$slots,"header-actions"),f(E,{items:[[{label:"Rename",icon:"i-ph-pencil",click:()=>{c.value="edit"}},{label:"Delete",icon:"i-ph-trash",click:()=>{d()}}]],mode:"hover",popper:{placement:"bottom-end"}},{default:v(()=>[f(p,{size:"xs",icon:"i-ph-dots-three-outline-vertical-thin"})]),_:1},8,["items"])])])]),footer:v(()=>[n("div",Z,[n("div",H,[n("div",Q,[f(o,{name:"i-ph-file-duotone"}),k(" "+V(s(T)),1)]),n("div",W,[f(o,{name:"i-ph-file-duotone"}),k(" "+V(e.item.mimeType),1)]),b(i.$slots,"footer-bar")]),n("div",ee,[b(i.$slots,"footer-actions"),f(p,{color:"white",label:"Download",icon:"i-ph-download",size:"xs",onClick:h})])])]),default:v(()=>[e.isLoading?(u(),$("div",J,[n("div",X,[Y,f(o,{name:"i-ph-circle-notch-duotone",class:"animate-spin"})])])):b(i.$slots,"default",{key:1})]),_:3})}}}),ie=x(()=>w(()=>import("./Db0EqV78.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),oe=x(()=>w(()=>import("./Cco9wy8A.js"),__vite__mapDeps([4,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),ae=x(()=>w(()=>import("./BIflh52r.js"),__vite__mapDeps([5,1,2,3]),import.meta.url).then(e=>N(e.default||e.default||e))),ne=x(()=>w(()=>import("./BFO3KDlm.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url).then(e=>e.default||e.default||e)),se=x(()=>w(()=>import("./Dv1NGRQv.js"),__vite__mapDeps([8,1,2,3]),import.meta.url).then(e=>e.default||e.default||e)),le={class:"flex-1 flex justify-center items-center"},re={class:"flex flex-col justify-center items-center gap-1"},fe=n("span",null,"Preview Not Available",-1),ce=B({__name:"FileViewer.client",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},flaff:{type:Object,required:!0}},emits:["flaffUpdated","changeFileByName"],setup(e,{emit:R}){const a=e,_={ps:"text/pinescript",pinescript:"text/pinescript",sav:"text/sav",ts:"text/typescript",tsx:"text/typescript",js:"text/javascript",jsx:"text/javascript",json:"text/json",yml:"text/yaml",yaml:"text/yaml",md:"text/markdown",markdown:"text/markdown",csv:"text/csv"},l=y(()=>{const t=a.item.extension,o=a.item.mimeType;return _[t]?_[t]:o}),T=["application/pdf","text/*","image/*","video/mp4"],h=y(()=>{const t=l.value;return T.some(o=>new RegExp(o.replace("*",".*")).test(t))}),c={"image/*":ie,"application/pdf":oe,"text/*":ae,"video/mp4":ne},m=t=>{const o=Object.entries(c).find(([p])=>new RegExp(p.replace("*",".*")).test(l.value));return o==null?void 0:o[1]},g=y(()=>{const t=se;return m(l.value)||t}),d=F(),i=y(()=>{if(d.value){const t=m(d.value);if(t)return t}return g.value});return(t,o)=>{const p=U,E=te;return s(h)||s(d)?(u(),L(S(s(i)),{key:0,"flaff-id":e.flaffId,item:e.item,mimeType:s(l),flaff:e.flaff,onFlaffUpdated:o[0]||(o[0]=(...r)=>{t.$emit("flaffUpdated",...r)}),onChangeFileByName:o[1]||(o[1]=r=>t.$emit("changeFileByName",r))},null,40,["flaff-id","item","mimeType","flaff"])):(u(),L(E,{key:1,flaff:e.flaff,"flaff-id":a.flaffId,"force-viewer-mime-type":s(d),"is-mime-readable":s(h),item:a.item,mimeType:s(l),onFlaffUpdated:o[3]||(o[3]=(...r)=>{console.log("flaff-updated"),t.$emit("flaffUpdated",...r)})},{default:v(()=>[n("div",le,[n("div",re,[fe,f(p,{label:"Read as Text",size:"xs",onClick:o[2]||(o[2]=r=>d.value="text/plain")})])])]),_:1},8,["flaff","flaff-id","force-viewer-mime-type","is-mime-readable","item","mimeType"]))}}}),pe=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));export{pe as F,te as _};
