const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DHu1Mw3S.js","./C-7uryom.js","./entry.BjR7VLcc.css","./DOwFC9TG.js","./DRS-Xb6D.js","./BhVeADxB.js","./CbwjHgsT.js","./Video.CYvUkbQJ.css","./BqgOLRUU.js","./D3JLYN9n.js"])))=>i.map(i=>d[i]);
import{D as O,a8 as z,F as y,r as V,n as S,an as A,o as f,a2 as F,w as g,b as s,W as k,d as u,x as r,c as E,t as U,as as M,ap as P,at as N,I as w,a5 as L,e as j,Y as q,aa as C,aq as _,_ as v,a7 as K}from"./C-7uryom.js";import{_ as W,a as G,c as J}from"./DOwFC9TG.js";const X={class:"flex items-center gap-2"},Y={class:"flex gap-2"},Z={key:0,class:"flex gap-2"},H={key:0,class:"flex-1 flex justify-center items-center"},Q={class:"flex items-center gap-1"},ee=s("span",null,"Loading Preview",-1),te={class:"flex items-center gap-2 divide-x divide-gray-500"},ie={class:"flex items-center gap-1 text-sm"},ae={class:"pl-2 flex items-center gap-1 text-sm"},oe={class:"flex gap-2"},ne=O({__name:"FileViewerContainer",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},forceViewerMimeType:{type:String},isMimeReadable:{type:Boolean,default:!0},mimeType:{type:String,required:!0},isLoading:{type:Boolean,default:!1},flaff:{type:Object,required:!0}},emits:["flaffUpdated"],setup(t,{emit:R}){const o=t,x=R,d=z(),T=y(()=>{const e=o.item.size;return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:e<1024*1024*1024?`${(e/1024/1024).toFixed(2)} MB`:`${(e/1024/1024/1024).toFixed(2)} GB`}),h=async()=>{try{const e=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{responseType:"blob"});if(e instanceof Blob){const i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=o.item.name,n.click(),URL.revokeObjectURL(i)}else if(e instanceof MediaSource){const i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=o.item.name,n.click(),URL.revokeObjectURL(i)}else d.add({title:"Error",description:"Failed to download file"})}catch(e){console.error("error",e)}},c=V("view");S(c,e=>{if(e==="edit"){const i=document.querySelector(".input-rename");i==null||i.focus()}});const p=V(!1),b=async()=>{if(p.value)return;p.value=!0;const e=o.item.name;try{const i=await $fetch(`/api/flaff/${o.flaff.uuid}/file/${o.item.uuid}/rename`,{method:"PUT",body:JSON.stringify({name:o.item.name})});c.value="view",console.log("res",i)}catch(i){console.error("error",i),o.item.name=e}p.value=!1,console.log("rename",o.item.name),x("flaffUpdated")},m=async()=>{try{const e=await $fetch(`/api/flaff/${o.flaffId}/file/${o.item.uuid}`,{method:"DELETE"});console.log("res",e),x("flaffUpdated",!0),d.add({title:"Success",description:"File deleted"})}catch(e){console.error("error",e),d.add({title:"Error",description:"Failed to delete file"})}},{width:$}=A(),a=y(()=>$.value<768);return(e,i)=>{const n=q,l=C,D=W,I=G;return f(),F(I,{class:"flex-1 flex flex-col",ui:{body:{base:"flex-1 flex overflow-y-auto",padding:"p-0 sm:p-0"}}},{header:g(()=>[s("div",null,[s("div",{class:k(["flex justify-between",{}])},[s("div",X,[u(n,{name:"i-ph-file-duotone"}),r(c)=="view"?(f(),E("span",{key:0,onDblclick:i[0]||(i[0]=B=>c.value="edit")},U(t.item.name),33)):M((f(),E("input",{key:1,autofocus:"","onUpdate:modelValue":i[1]||(i[1]=B=>t.item.name=B),onBlur:b,onKeyup:P(b,["enter"]),class:"input-rename bg-transparent border-b border-gray-500"},null,544)),[[N,t.item.name]])]),s("div",Y,[r(a)?L("",!0):w(e.$slots,"header-actions",{key:0}),o.flaff.isOwner?(f(),F(D,{key:1,items:[[{label:"Rename",icon:"i-ph-pencil",click:()=>{c.value="edit"}},{label:"Delete",icon:"i-ph-trash",click:()=>{m()}}]],popper:{placement:"bottom-end"}},{default:g(()=>[u(l,{size:"xs",icon:"i-ph-dots-three-outline-vertical-thin"})]),_:1},8,["items"])):L("",!0)])]),r(a)?(f(),E("div",Z,[w(e.$slots,"header-actions")])):L("",!0)])]),footer:g(()=>[s("div",{class:k(["flex justify-between",{"flex-col items-center gap-2":r(a),"flex-row":!r(a)}])},[s("div",te,[s("div",ie,[u(n,{name:"i-ph-file-duotone"}),j(" "+U(r(T)),1)]),s("div",ae,[u(n,{name:"i-ph-file-duotone"}),j(" "+U(t.mimeType),1)]),w(e.$slots,"footer-bar")]),s("div",oe,[w(e.$slots,"footer-actions"),u(l,{color:"white",label:"Download",icon:"i-ph-download",size:"xs",onClick:h})])],2)]),default:g(()=>[t.isLoading?(f(),E("div",H,[s("div",Q,[ee,u(n,{name:"i-ph-circle-notch-duotone",class:"animate-spin"})])])):w(e.$slots,"default",{key:1})]),_:3})}}}),se=_(()=>v(()=>import("./DHu1Mw3S.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),le=_(()=>v(()=>import("./DRS-Xb6D.js"),__vite__mapDeps([4,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),re=_(()=>v(()=>import("./BhVeADxB.js"),__vite__mapDeps([5,3,1,2]),import.meta.url).then(t=>J(t.default||t.default||t))),de=_(()=>v(()=>import("./CbwjHgsT.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url).then(t=>t.default||t.default||t)),fe=_(()=>v(()=>import("./BqgOLRUU.js"),__vite__mapDeps([8,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),ce=_(()=>v(()=>import("./D3JLYN9n.js"),__vite__mapDeps([9,1,2,3]),import.meta.url).then(t=>t.default||t.default||t)),me={class:"flex-1 flex justify-center items-center"},ue={class:"flex flex-col justify-center items-center gap-1"},pe=s("span",null,"Preview Not Available",-1),ye=O({__name:"FileViewer.client",props:{flaffId:{type:String,required:!0},item:{type:Object,required:!0},flaff:{type:Object,required:!0}},emits:["flaffUpdated","changeFileByName","changeFileByUuid"],setup(t,{emit:R}){const o=t,x={ps:"text/pinescript",pinescript:"text/pinescript",sav:"text/sav",ts:"text/typescript",tsx:"text/typescript",js:"text/javascript",jsx:"text/javascript",json:"text/json",yml:"text/yaml",yaml:"text/yaml",md:"text/markdown",markdown:"text/markdown",csv:"text/csv"},d=y(()=>{const a=o.item.extension,e=o.item.mimeType;return x[a]?x[a]:e}),T=["application/x-directory","application/pdf","text/*","image/*","video/mp4"],h=y(()=>{const a=d.value;return T.some(e=>new RegExp(e.replace("*",".*")).test(a))}),c={"image/*":se,"application/pdf":le,"text/*":re,"application/x-directory":ce,"video/mp4":de},p=a=>{const e=Object.entries(c).find(([i])=>new RegExp(i.replace("*",".*")).test(d.value));return e==null?void 0:e[1]},b=y(()=>{const a=fe;return p(d.value)||a}),m=V(),$=y(()=>{if(m.value){const a=p(m.value);if(a)return a}return b.value});return(a,e)=>{const i=C,n=ne;return r(h)||r(m)?(f(),F(K(r($)),{key:0,"flaff-id":t.flaffId,item:t.item,mimeType:r(d),flaff:t.flaff,onFlaffUpdated:e[0]||(e[0]=(...l)=>{a.$emit("flaffUpdated",...l)}),onChangeFileByName:e[1]||(e[1]=l=>a.$emit("changeFileByName",l)),onChangeFileByUuid:e[2]||(e[2]=l=>a.$emit("changeFileByUuid",l))},null,40,["flaff-id","item","mimeType","flaff"])):(f(),F(n,{key:1,flaff:t.flaff,"flaff-id":o.flaffId,"force-viewer-mime-type":r(m),"is-mime-readable":r(h),item:o.item,mimeType:r(d),onFlaffUpdated:e[4]||(e[4]=(...l)=>{console.log("flaff-updated"),a.$emit("flaffUpdated",...l)}),onChangeFileByUuid:e[5]||(e[5]=l=>a.$emit("changeFileByUuid",l))},{default:g(()=>[s("div",me,[s("div",ue,[pe,u(i,{label:"Read as Text",size:"xs",onClick:e[3]||(e[3]=l=>m.value="text/plain")})])])]),_:1},8,["flaff","flaff-id","force-viewer-mime-type","is-mime-readable","item","mimeType"]))}}}),xe=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{xe as F,ne as _};
